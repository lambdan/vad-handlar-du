<div class="container">
  <div class="card">
    <h1 class="card-header text-center">Products</h1>
    <h5 class="card-header text-center text-muted">
      <%PRODUCT_COUNT%> products
    </h5>
    <div class="card-body">
      <input
        class="form-control"
        id="searchInput"
        type="text"
        placeholder="Search..."
        onkeyup="debouncedSearch()"
      />

      <hr />

      <table class="sortable table table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Times Purchased</th>
            <th>Amount Purchased</th>
            <th>Money Spent üí∏</th>
            <th>Last Purchased üìÜ</th>
            <th>Lowest Price ‚¨áÔ∏è</th>
            <th>Highest Price ‚¨ÜÔ∏è</th>
            <th>Lowest/Highest Delta ‚¨áÔ∏è‚¨ÜÔ∏è</th>
          </tr>
        </thead>
        <tbody>
          <%TABLE_ROWS%>
        </tbody>
      </table>

      <hr />

      <a href="/products/delete_empty" class="btn btn-danger">
        <i class="bi bi-trash"></i> Delete empty products
      </a>
    </div>
  </div>
</div>

<script>
  function debounce(func, wait) {
    let timeout;
    return function (...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  function searchTable() {
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const table = document.querySelector("table tbody");
    const rows = table.getElementsByTagName("tr");

    for (let i = 0; i < rows.length; i++) {
      const cells = rows[i].getElementsByTagName("td");
      let match = false;
      for (let j = 0; j < cells.length; j++) {
        if (cells[j].innerText.toLowerCase().indexOf(filter) > -1) {
          match = true;
          break;
        }
      }
      rows[i].style.display = match ? "" : "none";
    }
  }

  const debouncedSearch = debounce(searchTable, 150);
</script>
